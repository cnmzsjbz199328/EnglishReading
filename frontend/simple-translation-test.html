<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç¿»è¯‘æ£€æµ‹æµ‹è¯•</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
    }
    
    .status {
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
      font-weight: bold;
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
    }
    
    .test-content {
      background: #f5f5f5;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
      border-left: 4px solid #007acc;
    }
    
    .log {
      background: #2d2d2d;
      color: #00ff00;
      padding: 15px;
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      height: 200px;
      overflow-y: auto;
      white-space: pre-wrap;
    }
    
    button {
      background: #007acc;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
    }
    
    .comparison-display {
      animation: slideIn 0.3s ease-out;
    }
    
    .protected-text {
      user-select: text;
      -webkit-user-select: text;
      -moz-user-select: text;
      -ms-user-select: text;
    }
    
    /* é¢å¤–ä¿æŠ¤åŸæ–‡æ˜¾ç¤ºåŒºåŸŸ */
    [translate="no"] {
      translate: no !important;
    }
    
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>
<body>
  <h1>ç¿»è¯‘æ£€æµ‹æµ‹è¯•</h1>
  
  <div class="status" id="status">
    ğŸ” å³é”®ç‚¹å‡»ä¸‹æ–¹æ–‡æœ¬ï¼Œé€‰æ‹©"ç¿»è¯‘ä¸ºä¸­æ–‡"è¿›è¡Œæµ‹è¯•
  </div>
  
  <div class="test-content" id="content">
    <h2>Test Text</h2>
    <p>Hello world! This is a simple test for browser translation detection.</p>
    <p>Artificial Intelligence is changing the world in many exciting ways.</p>
  </div>
  
  <button onclick="checkNow()">ç«‹å³æ£€æŸ¥</button>
  <button onclick="clearLog()">æ¸…é™¤æ—¥å¿—</button>
  <button onclick="clearComparisons()">æ¸…é™¤å¯¹æ¯”</button>
  
  <h3>æ—¥å¿—:</h3>
  <div class="log" id="log"></div>

  <script>
    console.log('Script started');
    
    let originalTexts = [];
    
    function log(msg) {
      const timestamp = new Date().toLocaleTimeString();
      const logEl = document.getElementById('log');
      logEl.textContent += `[${timestamp}] ${msg}\n`;
      logEl.scrollTop = logEl.scrollHeight;
      console.log(msg);
    }
    
    function clearLog() {
      document.getElementById('log').textContent = '';
      log('Log cleared');
    }
    
    function clearComparisons() {
      const comparisons = document.querySelectorAll('.comparison-display');
      comparisons.forEach(comp => comp.remove());
      log('Comparison displays cleared');
    }
    
    function saveOriginalTexts() {
      const elements = document.querySelectorAll('#content p, #content h2');
      elements.forEach((el, i) => {
        originalTexts[i] = el.textContent.trim();
        log(`Saved text ${i}: "${originalTexts[i].substring(0, 30)}..."`);
      });
    }
    
    function checkForTranslation() {
      const elements = document.querySelectorAll('#content p, #content h2');
      let changes = 0;
      
      elements.forEach((el, i) => {
        const current = el.textContent.trim();
        const original = originalTexts[i];
        
        if (original && current !== original) {
          log(`CHANGE DETECTED in element ${i}:`);
          log(`Original: "${original}"`);
          log(`Current:  "${current}"`);
          changes++;
          
          // åˆ›å»ºå¯¹æ¯”æ˜¾ç¤º
          createComparisonDisplay(el, original, current, i);
        }
      });
      
      if (changes > 0) {
        document.getElementById('status').innerHTML = 
          `âœ… æ£€æµ‹åˆ°ç¿»è¯‘ï¼å‘ç° ${changes} ä¸ªæ–‡æœ¬å˜åŒ–`;
        document.getElementById('status').style.background = '#d4edda';
        document.getElementById('status').style.color = '#155724';
        log(`*** TRANSLATION DETECTED: ${changes} changes found ***`);
      } else {
        log('No changes detected');
      }
      
      return changes > 0;
    }
    
    function createComparisonDisplay(element, original, translated, index) {
      // æ£€æŸ¥æ˜¯å¦å·²ç»åˆ›å»ºäº†å¯¹æ¯”æ˜¾ç¤º
      let comparisonId = `comparison-${index}`;
      let existingComparison = document.getElementById(comparisonId);
      
      if (!existingComparison) {
        // åˆ›å»ºå¯¹æ¯”å®¹å™¨
        const comparisonDiv = document.createElement('div');
        comparisonDiv.id = comparisonId;
        comparisonDiv.className = 'comparison-display';
        comparisonDiv.setAttribute('translate', 'no'); // é˜²æ­¢æ•´ä¸ªå¯¹æ¯”æ¡†è¢«ç¿»è¯‘
        comparisonDiv.style.cssText = `
          background: #f8f9fa;
          border: 2px solid #28a745;
          border-radius: 8px;
          padding: 15px;
          margin: 10px 0;
          box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        `;
        
        // æ’å…¥åˆ°åŸå…ƒç´ åé¢
        element.parentNode.insertBefore(comparisonDiv, element.nextSibling);
      } else {
        comparisonDiv = existingComparison;
      }
      
      // å¯¹åŸæ–‡è¿›è¡Œbase64ç¼–ç ä¿æŠ¤
      const protectedOriginal = btoa(unescape(encodeURIComponent(original)));
      
      // æ›´æ–°å¯¹æ¯”å†…å®¹
      comparisonDiv.innerHTML = `
        <div style="display: block; gap: 15px;">
          <div style="margin-bottom: 15px;">
            <div style="font-weight: bold; color: #007acc; margin-bottom: 8px;" translate="no">
              ğŸ‡ºğŸ‡¸ åŸæ–‡:
            </div>
            <div style="background: #e3f2fd; padding: 12px; border-radius: 4px; border-left: 4px solid #2196f3;" 
                 translate="no" 
                 data-original="${protectedOriginal}"
                 id="original-${index}">
              <span class="protected-text">${original}</span>
            </div>
          </div>
          <div>
            <div style="font-weight: bold; color: #e91e63; margin-bottom: 8px;" translate="no">
              ğŸ‡¨ğŸ‡³ è¯‘æ–‡:
            </div>
            <div style="background: #fce4ec; padding: 12px; border-radius: 4px; border-left: 4px solid #e91e63;">
              ${translated}
            </div>
          </div>
        </div>
      `;
      
      // å¯åŠ¨åŸæ–‡ä¿æŠ¤ç›‘æ§
      startOriginalTextProtection(index);
    }
    
    function startOriginalTextProtection(index) {
      const originalElement = document.getElementById(`original-${index}`);
      if (!originalElement) return;
      
      // è·å–å—ä¿æŠ¤çš„åŸæ–‡
      const protectedData = originalElement.getAttribute('data-original');
      const originalText = decodeURIComponent(escape(atob(protectedData)));
      
      // åˆ›å»ºMutationObserverç›‘æ§åŸæ–‡åŒºåŸŸ
      const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          if (mutation.type === 'childList' || mutation.type === 'characterData') {
            const currentText = originalElement.textContent.trim();
            if (currentText !== originalText) {
              log(`âš ï¸ Original text protection: restoring element ${index}`);
              // æ¢å¤åŸæ–‡
              originalElement.innerHTML = `<span class="protected-text">${originalText}</span>`;
            }
          }
        });
      });
      
      // å¼€å§‹ç›‘æ§
      observer.observe(originalElement, {
        childList: true,
        subtree: true,
        characterData: true
      });
      
      log(`ğŸ›¡ï¸ Protection activated for original text ${index}`);
    }
    
    function checkNow() {
      log('Manual check triggered');
      checkForTranslation();
    }
    
    // ç®€å•çš„åˆå§‹åŒ–
    function init() {
      log('Page initialization started');
      saveOriginalTexts();
      
      // å®šæœŸæ£€æŸ¥
      setInterval(() => {
        checkForTranslation();
      }, 2000);
      
      log('Monitoring started - checking every 2 seconds');
    }
    
    // ç­‰å¾…é¡µé¢åŠ è½½
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
    
    console.log('Script setup complete');
  </script>
</body>
</html>
