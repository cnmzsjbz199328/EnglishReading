<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>TTS API æµ‹è¯• - æ–°ç‰ˆæœ¬</title>
  <style>
    body { font-family: sans-serif; padding: 2em; background: #f9f9f9; }
    button { font-size: 1em; padding: 0.5em; margin: 0.5em; }
    textarea { width: 100%; height: 100px; margin: 0.5em 0; }
    #log { background: #eee; padding: 1em; white-space: pre-wrap; font-family: monospace; height: 300px; overflow-y: auto; margin-top: 1em; }
    .controls { margin: 1em 0; }
    audio { width: 100%; margin-top: 1em; }
  </style>
</head>
<body>
  <h1>ğŸ—£ï¸ TTS API æµ‹è¯• (æ–°ç‰ˆæœ¬)</h1>
  
  <div class="controls">
    <label>æµ‹è¯•æ–‡æœ¬:</label>
    <textarea id="textInput">Hello, this is a test of our new TTS API integration.</textarea>
  </div>
  
  <div class="controls">
    <label>è¯­è¨€:</label>
    <select id="langSelect">
      <option value="en-US">English (US)</option>
      <option value="cmn-CN">ä¸­æ–‡ (æ™®é€šè¯)</option>
      <option value="zh-TW">ä¸­æ–‡ (å°æ¹¾)</option>
    </select>
  </div>
  
  <div class="controls">
    <button onclick="testVoicesList()">ğŸ“œ è·å–å£°éŸ³åˆ—è¡¨</button>
    <button onclick="testTTSSynthesis()">ğŸ”Š è¯­éŸ³åˆæˆæµ‹è¯•</button>
    <button onclick="clearLog()">ğŸ—‘ï¸ æ¸…é™¤æ—¥å¿—</button>
  </div>
  
  <audio id="audioPlayer" controls style="width: 100%; margin: 1em 0;"></audio>
  
  <h3>ğŸ“‹ æµ‹è¯•æ—¥å¿—:</h3>
  <div id="log"></div>

  <script>
    const log = (msg) => {
      const logBox = document.getElementById("log");
      const timestamp = new Date().toLocaleTimeString();
      logBox.textContent += `[${timestamp}] ${msg}\n`;
      logBox.scrollTop = logBox.scrollHeight;
    };

    const clearLog = () => {
      document.getElementById("log").textContent = '';
    };

    // æµ‹è¯•è·å–å£°éŸ³åˆ—è¡¨
    async function testVoicesList() {
      try {
        const language = document.getElementById('langSelect').value;
        const url = `https://english-reading-app.tj15982183241.workers.dev/api/tts/voices?language=${encodeURIComponent(language)}`;
        
        log(`ğŸ“¡ è¯·æ±‚å£°éŸ³åˆ—è¡¨: ${url}`);
        
        const response = await fetch(url, {
          method: 'GET',
          headers: {
            'Content-Type': 'application/json'
          }
        });
        
        log(`ğŸ“Š å“åº”çŠ¶æ€: ${response.status} ${response.statusText}`);
        
        if (!response.ok) {
          const errorText = await response.text();
          log(`âŒ è¯·æ±‚å¤±è´¥: ${errorText}`);
          return;
        }
        
        const data = await response.json();
        log(`âœ… æˆåŠŸè·å–å£°éŸ³åˆ—è¡¨:`);
        log(JSON.stringify(data, null, 2));
        
      } catch (error) {
        log(`ğŸ’¥ è¯·æ±‚å¼‚å¸¸: ${error.message}`);
      }
    }

    // æµ‹è¯•TTSåˆæˆ
    async function testTTSSynthesis() {
      try {
        const text = document.getElementById('textInput').value.trim();
        const language = document.getElementById('langSelect').value;
        
        if (!text) {
          log('âš ï¸ è¯·è¾“å…¥æµ‹è¯•æ–‡æœ¬');
          return;
        }
        
        const url = 'https://english-reading-app.tj15982183241.workers.dev/api/tts/preview';
        const requestBody = {
          text: text,
          language: language,
          voice: 'auto',
          encoding: 'MP3',
          rate: 1.0,
          pitch: 0.0,
          useSSML: false
        };
        
        log(`ğŸ“¡ è¯·æ±‚TTSåˆæˆ: ${url}`);
        log(`ğŸ“¦ è¯·æ±‚æ•°æ®: ${JSON.stringify(requestBody, null, 2)}`);
        
        const response = await fetch(url, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(requestBody)
        });
        
        log(`ğŸ“Š å“åº”çŠ¶æ€: ${response.status} ${response.statusText}`);
        
        if (!response.ok) {
          const errorText = await response.text();
          log(`âŒ è¯·æ±‚å¤±è´¥: ${errorText}`);
          return;
        }
        
        // å¤„ç†éŸ³é¢‘å“åº”
        const audioBuffer = await response.arrayBuffer();
        const audioBlob = new Blob([audioBuffer], { type: 'audio/mpeg' });
        
        log(`âœ… æ”¶åˆ°éŸ³é¢‘æ•°æ®ï¼Œå¤§å°: ${audioBlob.size} å­—èŠ‚`);
        
        // æ’­æ”¾éŸ³é¢‘
        const audioUrl = URL.createObjectURL(audioBlob);
        const audioPlayer = document.getElementById('audioPlayer');
        audioPlayer.src = audioUrl;
        
        log('ğŸµ éŸ³é¢‘å·²åŠ è½½åˆ°æ’­æ”¾å™¨ï¼Œç‚¹å‡»æ’­æ”¾æŒ‰é’®æ”¶å¬');
        
      } catch (error) {
        log(`ğŸ’¥ è¯·æ±‚å¼‚å¸¸: ${error.message}`);
      }
    }

    // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
      log('ğŸš€ TTS API æµ‹è¯•é¡µé¢å·²åŠ è½½');
      log('ğŸ’¡ æç¤º: è¯·ç¡®ä¿å¼€å‘æœåŠ¡å™¨è¿è¡Œåœ¨ http://127.0.0.1:8787');
    });
  </script>
</body>
</html>
