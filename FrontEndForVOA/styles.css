*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Arial,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;color:#333;-webkit-font-smoothing:antialiased;}
.container{max-width:1200px;margin:0 auto;padding:22px 22px 140px;}
.header{text-align:center;margin-bottom:30px;padding:22px 20px 28px;background:rgba(255,255,255,0.9);border-radius:24px;backdrop-filter:blur(20px);box-shadow:0 10px 30px rgba(0,0,0,0.07);}
.header h1{font-size:2.35em;color:#2c3e50;margin-bottom:20px;font-weight:700;letter-spacing:.5px;}
.controls-top{display:flex;flex-direction:row;flex-wrap:nowrap;align-items:center;gap:10px;justify-content:flex-start;overflow-x:auto;-webkit-overflow-scrolling:touch;}
.controls-top > .select-wrapper,.controls-top > button#modeToggle{flex:1 1 0;min-width:30px;width:auto;}
.controls-top select{width:100%;box-sizing:border-box;}
.controls-selects{display:flex;flex-direction:row;gap:10px;flex:1 1 auto;min-width:0;}
.controls-selects .select-wrapper{flex:1 1 0;min-width:120px;}
.select-wrapper{position:relative;}
select{appearance:none;background:rgba(255,255,255,0.9);border:2px solid rgba(255,255,255,0.4);border-radius:14px;padding:12px 44px 12px 16px;font-size:14px;width:220px;cursor:pointer;transition:.25s;}
select:hover{background:#fff;border-color:#667eea;}
select:disabled{opacity:.55;cursor:not-allowed;}
.select-wrapper::after{content:'▼';position:absolute;right:14px;top:50%;transform:translateY(-50%);font-size:12px;color:#666;pointer-events:none;}
.reading-mode-btn{background:rgba(240 241 251);border:2px solid rgba(255,255,255,0.4);border-radius:14px;padding:12px 0px;font-size:14px;cursor:pointer;font-weight:500;transition:.25s;}
.reading-mode-btn:hover{background:#fff;border-color:#667eea;color:#667eea;}
.reading-mode-btn.active{background:#667eea;color:#fff;border-color:#667eea;}
.current-feed{color:#f0f3ff;font-size:13px;margin:0 4px 14px;text-shadow:0 1px 2px rgba(0,0,0,.25);}
.content-area{background:rgba(255,255,255,0.95);border-radius:24px;padding:32px 30px 40px;backdrop-filter:blur(18px);box-shadow:0 20px 40px rgba(0,0,0,0.08);}
#detail h3{font-size:1.75em;margin:0 0 18px;color:#2c3e50;font-weight:600;}
#reader{font-size:1.02em;line-height:1.75;text-align:justify;max-height:50vh;overflow-y:auto;padding:14px 18px;border:1px solid #e3e8ef;border-radius:16px;background:#fff;box-shadow:0 2px 6px rgba(0,0,0,0.04) inset;}
.seg{padding:2px 3px;border-radius:4px;transition:background .25s,color .25s;display:inline;}
.seg.active{background:#ffe58f;box-shadow:0 0 0 2px #ffd666 inset;}
.seg.past{color:#666;}
.loading{color:#667;font-style:italic;}
.error{color:#c62828;}
.subtitle-layer{margin-top:26px;background:#0d1117;color:#fff;border-radius:20px;padding:34px 32px 40px;font-size:20px;line-height:1.55;min-height:140px;box-shadow:0 6px 18px rgba(0,0,0,.25);}
.subtitle-layer.hidden{display:none;}
.subtitle-line{transition:opacity .25s;}
.subtitle-next{opacity:.55;font-size:.9em;margin-top:14px;}
.subtitle-highlight{background:#ffe58f;color:#222;padding:4px 6px;border-radius:8px;}
/* 浮动播放器 */
.floating-player{position:fixed;left:50%;bottom:24px;transform:translateX(-50%);background:rgba(0,0,0,.82);backdrop-filter:blur(20px);border-radius:22px;padding:18px 26px;color:#fff;box-shadow:0 14px 34px rgba(0,0,0,.35);min-width:480px;z-index:1000;animation:slideUp .5s ease;font-size:14px;opacity: 0.8;}
@keyframes slideUp{from{opacity:0;transform:translate(-50%,20px);}to{opacity:1;transform:translate(-50%,0);}}
.player-row{display:flex;align-items:center;gap:18px;}
.play-btn{width:56px;height:56px;border-radius:50%;background:linear-gradient(135deg,#667eea,#764ba2);border:none;color:#fff;font-size:22px;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 16px rgba(102,126,234,.45);transition:.28s;}
.play-btn:hover{transform:scale(1.06);box-shadow:0 6px 22px rgba(102,126,234,.65);}
.progress-container{flex:1;display:flex;flex-direction:column;gap:6px;}
.time-bar{display:flex;justify-content:space-between;font-size:12px;color:rgba(255,255,255,.75);}
.progress-bar{height:7px;background:rgba(255,255,255,.18);border-radius:4px;cursor:pointer;position:relative;overflow:hidden;}
.progress-fill{height:100%;width:0%;background:linear-gradient(90deg,#667eea,#764ba2);border-radius:4px;position:relative;transition:width .12s linear;}
.progress-fill::after{content:'';position:absolute;right:0;top:50%;transform:translateY(-50%);width:14px;height:14px;background:#fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2);opacity:0;transition:.3s;}
.progress-bar:hover .progress-fill::after{opacity:1;}
.speed-control,.volume-control{display:flex;align-items:center;gap:8px;background:rgba(255,255,255,.12);padding:8px 10px;border-radius:12px;}
.speed-btn{background:none;border:none;color:rgba(255,255,255,.75);font-size:18px;cursor:pointer;min-width:24px;transition:.25s;border-radius:6px;padding:2px 4px;}
.speed-btn:hover{color:#fff;background:rgba(255,255,255,.15);}
.speed-display{min-width:46px;text-align:center;font-weight:600;font-size:13px;}
.volume-btn{background:none;border:none;font-size:20px;cursor:pointer;color:rgba(255,255,255,.75);transition:.25s;}
.volume-btn:hover{color:#fff;}
.volume-slider{width:70px;height:6px;background:rgba(255,255,255,.25);border-radius:3px;cursor:pointer;position:relative;}
.volume-fill{height:100%;background:#fff;border-radius:3px;width:70%;position:relative;transition:width .15s;}
.volume-fill::after{content:'';position:absolute;right:0;top:50%;transform:translateY(-50%);width:12px;height:12px;background:#fff;border-radius:50%;box-shadow:0 1px 3px rgba(0,0,0,.3);}
.no-media{font-size:14px;color:rgba(255,255,255,.6);margin-right:14px;}
.hidden-audio{display:none !important;}
@media (max-width:860px){.floating-player{min-width:0;width:92%;left:50%;transform:translateX(-50%);padding:16px 18px;}.player-row{flex-wrap:wrap;gap:12px;}.progress-container{order:3;width:100%;}}
@media (max-width:620px){.header h1{font-size:1.9em;}.subtitle-layer{font-size:18px;padding:24px 22px 30px;}#reader{max-height:45vh;}}
@media (max-width:600px){
  .player-row .progress-container{flex:1 1 100%;flex-basis:100%;width:100%;min-width:0;}
  .player-row button#playBtn,
  .player-row .speed-control,
  .player-row .volume-control{flex-shrink:1;flex-basis:auto;min-width:0;}
}
/* 旧类兼容 */
.top-bar{display:none;} /* 隐藏旧布局 */
.mode-btn{display:none;}

/* ====== 更细致的小尺寸适配 ====== */
@media (max-width:540px){
  .container{padding:14px 12px 138px;}
  .header{padding:16px 14px 20px;margin-bottom:18px;border-radius:20px;}
  .header h1{font-size:clamp(1.35rem,5.2vw,1.85rem);margin-bottom:12px;}
  /* Single row controls (allow horizontal scroll if overflow) */
  .controls-top{display:flex;flex-direction:row;align-items:center;flex-wrap:nowrap;gap:8px;justify-content:flex-start;overflow-x:auto;padding-bottom:2px;-webkit-overflow-scrolling:touch;}
  .controls-top > .select-wrapper{flex:1 1 0;min-width:0;}
  .controls-selects{gap:6px;}
  select{width:100%;max-width:none;padding:8px 30px 8px 10px;font-size:13px;border-radius:12px;}
  /* Icon button for mode toggle */
  #modeToggle.reading-mode-btn{flex:0 0 auto;font-size:0;text-indent:-9999px;overflow:hidden;padding:0;width:40px;height:40px;border-radius:12px;display:flex;align-items:center;justify-content:center;position:relative;border:none;outline:none;}
  #modeToggle.reading-mode-btn::after{content:"CC";font-size:13px;font-weight:600;letter-spacing:1px;color:#667eea;text-indent:0;}
  #modeToggle.reading-mode-btn.active::after{color:#fff;}
  #detail h3{font-size:1.4em;margin-bottom:12px;}
  #reader{max-height:54vh;padding:10px 12px;font-size:.94em;line-height:1.58;border-radius:14px;}
  .subtitle-layer{padding:18px 16px 24px;font-size:16.5px;line-height:1.42;border-radius:18px;}
  .subtitle-next{margin-top:8px;font-size:.83em;}
  .floating-player{width:100%;left:50%;transform:translateX(-50%);bottom:10px;padding:12px 12px;border-radius:18px;min-width:0;font-size:12.5px;}
  .player-row{flex-wrap:wrap;gap:8px;}
  .play-btn{width:50px;height:50px;font-size:19px;}
  .speed-control,.volume-control{padding:6px 6px;gap:6px;}
  .speed-display{min-width:38px;font-size:11.5px;}
  .volume-slider{width:58px;}
  .progress-container{gap:4px;}
  .progress-bar{height:6px;}
  .progress-fill::after{width:11px;height:11px;}
}
/* Ensure still row & wrapping option at <=430px (icon smaller) */
@media (max-width:430px){
  #modeToggle.reading-mode-btn{width:38px;height:38px;border-radius:10px;border:none;outline:none;}
  select{font-size:12.5px;padding:7px 28px 7px 9px;}
  .play-btn{width:46px;height:46px;font-size:18px;}
}
@media (max-width:370px){
  .header h1{font-size:1.35rem;}
  select{width:100%;}
  .controls-top > .select-wrapper,
  .controls-top > button{width:100%;}
  .floating-player{padding:12px 12px;}
  .play-btn{width:44px;height:44px;}
  .subtitle-layer{font-size:16px;}
}

/* 优化窄屏滚动体验：在键盘弹出时减少遮挡 */
@supports (height: 100dvh){
  body{min-height:100dvh;}
}

/* iOS 安全区域 */
@supports(padding: max(0px)){
  .floating-player{
    padding-bottom:calc(14px + env(safe-area-inset-bottom));
  }
}

/* 防止用户缩放导致布局溢出（可选） */
html{
  text-size-adjust:100%;
  -webkit-text-size-adjust:100%;
}
@media (max-width:1080px){
  #modeToggle.reading-mode-btn{flex:0 0 auto;font-size:0;text-indent:-9999px;overflow:hidden;padding:0;width:46px;height:46px;border-radius:14px;display:flex;align-items:center;justify-content:center;position:relative;}
  #modeToggle.reading-mode-btn::after{content:"CC";font-size:15px;font-weight:600;letter-spacing:1px;color:#667eea;text-indent:0;}
  #modeToggle.reading-mode-btn.active::after{color:#fff;}
}
